@model MovieDemo.Models.Movie

@{
    ViewData["Title"] = Model.Title;

    // Check navigation context
    var returnUrl = Context.Request.Query["returnUrl"].ToString();
    int? fromListId = ViewBag.FromListId;
}

<div class="container mt-5">
    <div class="row bg-dark text-white rounded-4 shadow-lg overflow-hidden border border-secondary">
        @* --- Poster Section --- *@
        <div class="col-md-5 p-0">
            @{
                var posterSrc = "";

                if (string.IsNullOrEmpty(Model.PosterUrl))
                {
                    posterSrc = "https://via.placeholder.com/500x750?text=No+Poster";
                }
                // 1. Check if it is a full web URL
                else if (Model.PosterUrl.StartsWith("http"))
                {
                    posterSrc = Model.PosterUrl;
                }
                // 2. SMART LOGIC: Check if it is a local file in your 'images' folder
                // (Handles filenames like "gladiator.jpg" or paths like "/images/gladiator.jpg")
                else if (Model.PosterUrl.Contains(".") || Model.PosterUrl.StartsWith("/"))
                {
                    posterSrc = Model.PosterUrl.StartsWith("/") ? Model.PosterUrl : "/images/" + Model.PosterUrl;
                }
                // 3. Fallback to TMDB
                else
                {
                    posterSrc = "https://image.tmdb.org/t/p/w780" + Model.PosterUrl;
                }
            }
            <img src="@posterSrc" class="img-fluid w-100 h-100" style="object-fit: cover;" alt="@Model.Title">
        </div>

        @* --- Content Section --- *@
        <div class="col-md-7 p-5 d-flex flex-column justify-content-center">
            <h1 class="display-3 fw-bold mb-2">@Model.Title</h1>

            <div class="mb-4">
                @foreach (var genre in Model.Genres)
                {
                        <span class="badge rounded-pill bg-warning text-dark me-1 px-3 py-2">@genre.Name</span>
                }
            </div>

            <p class="lead text-secondary mb-4" style="line-height: 1.8;">@Model.Summary</p>

            <div class="row border-top border-secondary pt-4 mb-5">
                <div class="col-6">
                    <small class="text-muted d-block uppercase">Director</small>
                    <span class="fs-5 fw-bold text-info">@Model.Director</span>
                </div>
                <div class="col-3">
                    <small class="text-muted d-block uppercase">Release</small>
                    <span class="fs-5">@Model.ReleaseDate</span>
                </div>
                <div class="col-3">
                    <small class="text-muted d-block uppercase">Runtime</small>
                    <span class="fs-5">@Model.Runtime min</span>
                </div>
            </div>

            @* --- Navigation Buttons --- *@
            <div class="mt-auto d-flex gap-3">
                @if (returnUrl == "Manage")
                {
                        <a asp-action="Manage" class="btn btn-outline-light px-4 py-2 rounded-pill fw-bold">
                            <i class="bi bi-arrow-left"></i> Back to Manager
                        </a>
                        <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-info px-4 py-2 text-dark fw-bold rounded-pill">
                            <i class="bi bi-pencil-square"></i> Edit Movie
                        </a>
                }
                else if (fromListId.HasValue)
                {
                        <a asp-action="ListDetails" asp-route-id="@fromListId" class="btn btn-outline-warning px-4 py-2 rounded-pill fw-bold">
                            <i class="bi bi-collection-play me-2"></i> Back to List
                        </a>
                }
                else
                {
                        <a asp-action="IndexM" class="btn btn-outline-warning px-4 py-2 rounded-pill fw-bold">
                            <i class="bi bi-house me-2"></i> Back to Home
                        </a>
                }
            </div>
        </div>
    </div>
</div>

<style>
    body {
        background-color: #0f0f0f;
    }
    .uppercase {
        text-transform: uppercase;
        letter-spacing: 1px;
        font-size: 0.75rem;
    }
    /* Smooth hover effect for the big card */
    .row.bg-dark {
        transition: transform 0.3s ease;
    }
</style>